!function e(n,t,r){function o(u,a){if(!t[u]){if(!n[u]){var s="function"==typeof require&&require;if(!a&&s)return s(u,!0);if(i)return i(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var f=t[u]={exports:{}};n[u][0].call(f.exports,function(e){var t=n[u][1][e];return o(t||e)},f,f.exports,e,n,t,r)}return t[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,n,t){function r(){this.message="Index could not be found"}function o(e){this.message="Index with name '"+e+"' already exists and can not be created again;"}function i(e,n,t){var i=m.openDB(this._name);t=m.getFields(t);var u=JSON.stringify(t),a=l(this);return a?b.reject(a):p(i).then(function(){return v(i,e).then(function(){return b.reject(new o(e))}).catch(function(e){if(!(e instanceof r))return b.reject(e)})}).then(function(){return d(i,"INSERT INTO 'relation-indexes' VALUES (?,?,?)",[e,n,u])}).then(function(){return h(i,"_ri_"+e,m.getFields(["id","rev"].concat(t)))})}function u(e){var n=m.openDB(this._name),t=this,r=l(this);return r?b.reject(r):v(n,e).then(function(e){return d(n,"DELETE FROM "+m.wrapTableName("_ri_"+e.index_name)).then(function(){return e})}).then(function(e){return c(t,n,e)})}function a(e,n,t){var r=l(this);if(r)return b.reject(r);var o=m.openDB(this._name);return v(o,e).then(function(r){var i="_ri_"+e,u=n?y.query(n,i):null,a=u?u.query:"",s=u?u.args:[];a&&(a+=" AND ");var c=t?Object.keys(t).map(function(e){return m.wrapField(e,i)+" "+t[e].toUpperCase()}).join():"";return c&&(c+=","),d(o,"SELECT `by-sequence`.seq AS seq, `by-sequence`.deleted AS deleted, `by-sequence`.json AS data, `by-sequence`.rev AS rev, `document-store`.id AS id, `document-store`.json AS metadata \nFROM `document-store` \nJOIN `by-sequence` ON `by-sequence`.seq = `document-store`.winningseq \nJOIN `_ri_"+e+"` ON `document-store`.id = `_ri_"+e+"`.id\nWHERE "+a+"`by-sequence`.deleted = 0 ORDER BY "+c+" `document-store`.id ASC",s)}).then(function(e){for(var n=[],t=0;t<e.rows.length;t++){var r=e.rows.item(t);n.push(m.unstringifyDoc(r.data,r.id,r.rev))}return n})}function s(e){var n=l(this);if(n)return b.reject(n);var t=m.openDB(this._name);return b.all([d(t,"DELETE FROM 'relation-indexes' WHERE index_name = ?",[e]),d(t,"DROP TABLE IF EXISTS `_ri_"+e+"`")])}function c(e,n,t,r){return r=r||0,e.allDocs({startkey:t.doc_type,endkey:t.doc_type+"ï¿¿",include_docs:!0,skip:r,limit:1e3}).then(function(o){var i=o.rows.length;if(i){var u=m.wrapTableName("_ri_"+t.index_name),a=m.getFields(["_id","_rev"].concat(t.fields)),s=o.rows.map(function(e){var n=Array(a.length).fill("?"),t=a.map(function(n){return m.resolve(e.doc,n.name,null)});return["INSERT INTO "+u+" VALUES ("+n.join()+")",t]});return f(n,s).then(function(){if(1e3===i)return c(e,n,t,r+1e3)})}})}function f(e,n){return new b(function(t,r){"function"==typeof e.sqlBatch?e.sqlBatch(n,function(){return t()},r):e.transaction(function(e){m.eachAsync(n,function(n,t){e.executeSql(n[0],n[1],function(){t()},function(e,n){t(n)})},function(e){e?r(e):t()})},function(e){e?r(e):t()})})}function l(e){if("websql"!==e.adapter&&"cordova-sqlite"!==e.adapter)return new Error("Relation Index plugin support only websql or cordova-sqlite adapters")}function p(e){return h(e,"relation-indexes",[{name:"index_name",type:"TEXT"},{name:"doc_type",type:"TEXT"},{name:"json",type:"TEXT"}])}function h(e,n,t){return d(e,"CREATE TABLE IF NOT EXISTS '"+n+"' ("+t.map(function(e){return"`"+e.name+"` "+e.type}).join()+")").then(function(){})}function d(e,n,t){return new b(function(r,o){e.transaction(function(e){e.executeSql(n,t||[],function(e,n){r(n)},function(e,n){o(n)})},function(e){o(e)})})}function v(e,n){return d(e,"SELECT * FROM 'relation-indexes' WHERE index_name = ?",[n]).then(function(e){if(!e.rows.length)return b.reject(new o(n));var t=e.rows.item(0),r=JSON.parse(t.json);return{index_name:t.index_name,doc_type:t.doc_type,fields:r}})}var y=e("./query-builder.js"),m=e("./utils"),b=e("lie");r.prototype=Error.prototype,r.prototype.constructor=r,o.prototype=Error.prototype,o.prototype.constructor=o,t.createIndex=i,t.buildIndex=u,t.queryIndex=a,t.deleteIndex=s,"undefined"!=typeof window&&window.PouchDB&&window.PouchDB.plugin(t)},{"./query-builder.js":5,"./utils":6,lie:3}],2:[function(e,n,t){(function(e){"use strict";function t(){f=!0;for(var e,n,t=l.length;t;){for(n=l,l=[],e=-1;++e<t;)n[e]();t=l.length}f=!1}function r(e){1!==l.push(e)||f||o()}var o,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var u=0,a=new i(t),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),o=function(){s.data=u=++u%2}}else if(e.setImmediate||void 0===e.MessageChannel)o="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var n=e.document.createElement("script");n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},e.document.documentElement.appendChild(n)}:function(){setTimeout(t,0)};else{var c=new e.MessageChannel;c.port1.onmessage=t,o=function(){c.port2.postMessage(0)}}var f,l=[];n.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,n,t){"use strict";function r(){}function o(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=b,this.queue=[],this.outcome=void 0,e!==r&&s(this,e)}function i(e,n,t){this.promise=e,"function"==typeof n&&(this.onFulfilled=n,this.callFulfilled=this.otherCallFulfilled),"function"==typeof t&&(this.onRejected=t,this.callRejected=this.otherCallRejected)}function u(e,n,t){d(function(){var r;try{r=n(t)}catch(n){return v.reject(e,n)}r===e?v.reject(e,new TypeError("Cannot resolve promise with itself")):v.resolve(e,r)})}function a(e){var n=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof n)return function(){n.apply(e,arguments)}}function s(e,n){function t(n){i||(i=!0,v.reject(e,n))}function r(n){i||(i=!0,v.resolve(e,n))}function o(){n(r,t)}var i=!1,u=c(o);"error"===u.status&&t(u.value)}function c(e,n){var t={};try{t.value=e(n),t.status="success"}catch(e){t.status="error",t.value=e}return t}function f(e){return e instanceof this?e:v.resolve(new this(r),e)}function l(e){var n=new this(r);return v.reject(n,e)}function p(e){var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,o=!1;if(!t)return this.resolve([]);for(var i=new Array(t),u=0,a=-1,s=new this(r);++a<t;)!function(e,r){function a(e){i[r]=e,++u!==t||o||(o=!0,v.resolve(s,i))}n.resolve(e).then(a,function(e){o||(o=!0,v.reject(s,e))})}(e[a],a);return s}function h(e){var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,o=!1;if(!t)return this.resolve([]);for(var i=-1,u=new this(r);++i<t;)!function(e){n.resolve(e).then(function(e){o||(o=!0,v.resolve(u,e))},function(e){o||(o=!0,v.reject(u,e))})}(e[i]);return u}var d=e("immediate"),v={},y=["REJECTED"],m=["FULFILLED"],b=["PENDING"];n.exports=o,o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,n){if("function"!=typeof e&&this.state===m||"function"!=typeof n&&this.state===y)return this;var t=new this.constructor(r);if(this.state!==b){u(t,this.state===m?e:n,this.outcome)}else this.queue.push(new i(t,e,n));return t},i.prototype.callFulfilled=function(e){v.resolve(this.promise,e)},i.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},i.prototype.callRejected=function(e){v.reject(this.promise,e)},i.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},v.resolve=function(e,n){var t=c(a,n);if("error"===t.status)return v.reject(e,t.value);var r=t.value;if(r)s(e,r);else{e.state=m,e.outcome=n;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(n)}return e},v.reject=function(e,n){e.state=y,e.outcome=n;for(var t=-1,r=e.queue.length;++t<r;)e.queue[t].callRejected(n);return e},o.resolve=f,o.reject=l,o.all=p,o.race=h},{immediate:2}],4:[function(e,n,t){"use strict";function r(e,n,t){var r=t[t.length-1];e===r.element&&(t.pop(),r=t[t.length-1]);var o=r.element,i=r.index;if(Array.isArray(o))o.push(e);else if(i===n.length-2){var u=n.pop();o[u]=e}else n.push(e)}t.stringify=function(e){var n=[];n.push({obj:e});for(var t,r,o,i,u,a,s,c,f,l,p,h="";t=n.pop();)if(r=t.obj,o=t.prefix||"",i=t.val||"",h+=o,i)h+=i;else if("object"!=typeof r)h+=void 0===r?null:JSON.stringify(r);else if(null===r)h+="null";else if(Array.isArray(r)){for(n.push({val:"]"}),u=r.length-1;u>=0;u--)a=0===u?"":",",n.push({obj:r[u],prefix:a});n.push({val:"["})}else{s=[];for(c in r)r.hasOwnProperty(c)&&s.push(c);for(n.push({val:"}"}),u=s.length-1;u>=0;u--)f=s[u],l=r[f],p=u>0?",":"",p+=JSON.stringify(f)+":",n.push({obj:l,prefix:p});n.push({val:"{"})}return h},t.parse=function(e){for(var n,t,o,i,u,a,s,c,f,l=[],p=[],h=0;;)if("}"!==(n=e[h++])&&"]"!==n&&void 0!==n)switch(n){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,r(null,l,p);break;case"t":h+=3,r(!0,l,p);break;case"f":h+=4,r(!1,l,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(t="",h--;;){if(o=e[h++],!/[\d\.\-e\+]/.test(o)){h--;break}t+=o}r(parseFloat(t),l,p);break;case'"':for(i="",u=void 0,a=0;;){if('"'===(s=e[h++])&&("\\"!==u||a%2!=1))break;i+=s,u=s,"\\"===u?a++:a=0}r(JSON.parse('"'+i+'"'),l,p);break;case"[":c={element:[],index:l.length},l.push(c.element),p.push(c);break;case"{":f={element:{},index:l.length},l.push(f.element),p.push(f);break;default:throw new Error("unexpectedly reached end of input: "+n)}else{if(1===l.length)return l.pop();r(l.pop(),l,p)}}},{}],5:[function(e,n,t){function r(e,n){var t=[];return{query:o(e,n,t),args:t}}function o(e,n,t){var r=[];for(var u in e)if(e.hasOwnProperty(u)){var a=e[u];if(["$or","$and"].indexOf(u)>-1&&!Array.isArray(a))throw new Error("Use of $and, $or operator requires an array as its parameter.");switch(r.length&&r.push(" AND "),u){case"$or":var s=a.map(function(e){return o(e,n,t)});s.length&&r.push("("+s.join(" OR ")+")");break;case"$and":s=a.map(function(e){return o(e,n,t)}),s.length&&r.push("("+s.join(") AND (")+")");break;default:r.push(i(u,a,n,t))}}return r.join("")}function i(e,n,t,r){var i="";switch(e){case"$lt":i+=" < ?",r.push(n+"");break;case"$gt":i+=" > ?",r.push(n+"");break;case"$lte":i+=" <= ?",r.push(n+"");break;case"$gte":i+=" >= ?",r.push(n+"");break;case"$ne":i+=" != ?",r.push(n+"");break;case"$in":i=i+" IN ["+n.map(function(){return"?"}).join()+"]",r.push(n.map(function(e){return e+""||null}).join());break;case"$nin":i=i+" NOT IN ["+n.map(function(){return"?"}).join()+"]",r.push(n.map(function(e){return e+""||null}).join());break;case"$like":i+=" LIKE ?",r.push(n+"");break;default:i=i+"`"+t+"`.`"+e+"`"+("object"==typeof n?o(n,t,r):" = ?"),"object"!=typeof n&&r.push(n+"")}return i}t.query=r},{}],6:[function(e,n,t){"use strict";function r(){return"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1}function o(e){try{return JSON.parse(e)}catch(n){return i.parse(e)}}var i=e("vuvuzela");t.openDB=function(e){var n=r();return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase({name:e,version:1,description:"",size:n}):openDatabase(e,1,"",n)};var u=t.getFields=function(e){return e.map(function(e){var n="string"==typeof e?{name:e,type:"TEXT"}:e;return n.type=(n.type||"TEXT").toUpperCase(),n})};t.wrapFields=function(e,n){var t=a(n);return u(e).map(function(e){return t+".`"+e.name+"`"})},t.wrapField=function(e,n){return a(n)+".`"+e+"`"};var a=t.wrapTableName=function(e){return e?"`"+e+"`":""};t.resolve=function(e,n,t){return n.split(".").reduce(function(e,n){return e&&e[n]},e)||t},t.eachAsync=function(e,n,t){var r=0,o=e.length,i=function(u){!u&&r<o?(n(e[r],i),r++):"function"==typeof t&&t(u)};i()},t.unstringifyDoc=function(e,n,t){return e=o(e),e._id=n,e._rev=t,e}},{vuvuzela:4}]},{},[1]);
